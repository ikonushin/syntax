# üéØ SBank Flow - –û—à–∏–±–∫–∏ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

## –ü—Ä–æ–±–ª–µ–º–∞ ‚ùå
–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–ª—É—á–∏—Ç—å `consent_id` –ø–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –≤ SBank –ø–æ–ª—É—á–∞–ª–∏—Å—å –æ—à–∏–±–∫–∏:
- **401 Unauthorized** - "Invalid or expired access token"
- **404 Not Found** - –≠–Ω–¥–ø–æ–∏–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω

## –†–µ—à–µ–Ω–∏–µ ‚úÖ
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Å–ø–æ—Å–æ–±—ã –ø–µ—Ä–µ–¥–∞—á–∏ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è Authorization —Ç–æ–∫–µ–Ω–∞:

### Backend (`backend/routes/auth.py`)
```python
# –ë—ã–ª–æ:
from fastapi import APIRouter, HTTPException, status, Body, Depends
async def get_consent_details(
    consent_id: str,
    authorization: str = None,  # ‚ùå Query parameter
    ...
):

# –°—Ç–∞–ª–æ:
from fastapi import APIRouter, HTTPException, status, Body, Depends, Header
async def get_consent_details(
    consent_id: str,
    authorization: Optional[str] = Header(None),  # ‚úÖ Header parameter
    ...
):
```

### Frontend (`frontend/src/pages/BanksPage.jsx`)
```javascript
// –ë—ã–ª–æ:
await axios.get(`${API_URL}/api/consents/${consentLookupId}`, {
  params: {
    bank_id: sbankModal.bankId,
    access_token: sbankModal.accessToken  // ‚ùå Query parameter
  }
})

// –°—Ç–∞–ª–æ:
await axios.get(`${API_URL}/api/consents/${consentLookupId}`, {
  headers: {
    'Authorization': `Bearer ${sbankModal.accessToken}`  // ‚úÖ Header
  },
  params: {
    bank_id: sbankModal.bankId  // ‚úÖ Query parameter
  }
})
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç üéâ
‚úÖ Authorization header –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∏ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
‚úÖ –û—à–∏–±–æ–∫ 401 –∏ 404 –±–æ–ª—å—à–µ –Ω–µ—Ç
‚úÖ SBank flow —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é
‚úÖ –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
docker-compose up --build

# –í –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:5173
# 1. –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è
# 2. –ù–∞–∂–∞—Ç—å "Connect SBank"
# 3. –ù–∞–∂–∞—Ç—å "–Ø –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª"
# 4. –î–æ–ª–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—á–µ—Ç–∞ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

# –ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
./test_consent_lookup.sh
```

## –§–∞–π–ª—ã
- ‚úÖ **backend/routes/auth.py** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—É—á–µ–Ω–∏–µ Authorization header
- ‚úÖ **frontend/src/pages/BanksPage.jsx** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ Authorization header
- üìÑ **docs/SBANK_TEST_GUIDE.md** - –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- üìÑ **docs/SBANK_FIX_401_404.md** - –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
- üìÑ **SBANK_IMPLEMENTATION_SUMMARY.md** - –ü–æ–ª–Ω—ã–π summary

## –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é ‚ú®
